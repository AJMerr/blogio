<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <title>Sign Up!</title>
    <script src="https://cdn.jsdelivr.net/npm/@aws-amplify/ui@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@aws-amplify/auth@latest"></script>
    <nav>
      <ul><li><a href="index.html">BlogIO</a></li></ul>
    </nav>
  </head>
  <body>
    <main class="container">
      <article class="grid">
        <div>
        <form id="signUpForm">
          <label>
            Email
            <input type="email" id="email" placeholder="example@email.com" required />
            <small>A real email is required as you will have a code sent for confirmation</small>
          </label>
          <label>
            Password
            <input type="password" id="password" placeholder="password" pattern="." required />
          </label>
          <input type="submit" value="Sign Up"/>
          <small>Email me at austinm9506@gmail.com if you would like your data purged if you test this application.</small>
        </form>
        </div>
        <div>
        </div>
      </article>
      <div id="message"></div>
      <script>
      require("dotenv").config();

      Amplify.configure({
        Auth: {
          region: process.env.AWS_REGION,
          userPoolId: process.env.USER_POOL_ID,
          userPoolWebClientId: process.env.USER_POOL_CLIENT_ID
        }
      })

    async function signUp(email, password) {
      try {
        const { user } = await Amplify.Auth.signUp({
          username: email, // Using email as the username
          password,
          attributes: { email } // Setting the email attribute
        })
        document.getElementById("message").innerText = "Sign up successful!";
        console.log("Sign up successful", user);
      } catch (error) {
        document.getElementById("message").innerText = "Error signing up: " + error.message;
        console.error("Error signing up", error);
      }
    }

    document.getElementById("signUpForm").addEventListener("submit", async function(event) {
      event.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
    
      await signUp(email, password);
    })
      </script>
    </main>
  </body>
</html>
